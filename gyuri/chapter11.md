# 11 Nextjs 13과 리액트 18

## 1. app 디렉터리의 등장

### 11.1.1 라우팅

- 라우팅을 정의하는 법
  - /app/a/b는 /a/b로 변환되며. 파일명은 무시된다. 폴더명까지만 주소로 변환된다.
- layout.js : 주소별 공통 UI를 포함, app과 \_document를 대신해 웹페이지를 시작 하는 데 필요한 공통 코드를 삽입
- page.js
- error.js
  - error, js를 사용하면 특정 라우팅별 로 서로 다른 에러 내를 렌더링하는 것이 가능해
  - 에러 바운더리는 클라이언트에서만 작동하므로 error 컴 포넌트도 클라이언트 컴포넌트여야 한다
  - app/global-error.js : Layout에서 발생한 에러를 처리하고 싶을 때
- not-found.js : 404 페이지
  - 전체 애플리케이션에서 404를 노출하고 싶다면 app/not-found.js
- loading.js : Suspense를 기반으로 해당 컴포넌트가 불러오는 중임을 나타낼 때 사용
- route.js
  - route, ts 파일 내부에 REST API의 get, post와 같은 메서드명을 예약어로 선언해 두면 HTTP 요청에 맞 게 해당 메서드를 호출하는 방식으로 작동
  - route.ts가 존재하는 폴더 내부에는 page.tsx가 존재할 수 없다

## 2. 리액트 서버컴포넌트

### 11.2.1 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계

서버사이드 랜더링의 한계

- 자바스크립트 번들 크기가 0인 컴포넌트를 만들 수 없다
- 백엔드 리소스에 대한 직접적인 접근이 불가능하다
- 자동 코드 분할(code split)이 불가능하다
- 연쇄적으로 발생하는 클라이언트와 서버의 요청을 대응하기 어렵다
- 추상화에 드는 비용이 증가한다

### 11.2.2 서버컴포넌트란?

서버 컴포넌트(Server Component)란 하나의 언어，하나의 프레임워크，그리고 하나의 API와 개념을 사용 하면서 서버와 클라이언트 모두에서 컴포넌트를 렌더링할 수 있는 기법

### 11.2.3 서버 사이드 렌더링과 서버 컴포넌트의 차이

### 11.2.4 서버 컴포넌트는 어떻게 작동하는가?

- 서버 컴포넌트는 클라이언트 컴포넌트를 불러올 수 없으며, 클라이언트 컴포넌트는 서버 컴포넌트를 children props로 받는 것만 가능
- 루트 컴포넌트는 무조건 서버 컴포넌트가 된다
- next의 루트컴포넌트는 각 페이지에 존재하는 page.js 이다 그리고 layout.js도 마찬가지로 서버 컴포넌트로 작동
- page와 layout은 반드시 서버 컴포넌트여야 하며, 앞서 언급했던 서버 컴포넌트의 제약을 받는다

## 3. Next.js에서의 리액트 서버 컴포넌트

### 11.3.1 새로운 fetch 도입과 getServerSideProps, getStaticProps, getlnitial Props의 삼제

### 11.3.2 정적렌더링과 동적렌더링

- 과거에는 getStaticProps활용해 서버에서 불러오는 데이터가 변경되지 않는 경우 정적으로 페이지를 만들어 제공. 해당 주소로 들어오는 모든 결과물이 동일하기 때문에 cdn에서 캐싱해 기존 서버 사이드 렌더링보다 더 빠르게 데이터를 제공할 수 있는 장점이 있었다

- next13에서는 정적인 라우팅에 대해서는 기본적으로 빌드타임에 (해당 주소로 미리 요청을 해서 데이터를 가져온 다음)렌더링을 미리 해두고(렌더링 결과를 빌드에 넣어둠) 캐싱해 재사용할 수 있게 해뒀고, 동적인 라우팅에 대해서는 서버에 매번 요청이 올 때마다 컴포넌트를 렌더링 하도록 변경함

> ❓정적 캐싱 하지 않으려면?
> fetch 시 no-cache 옵션 추가

### 11.3.3 캐시와 mutating, 그리고 revalidating

캐시된 데이터를 두가지 방법으로 재검증할 수 있다

- Time-based revalidation 일정 시간이 지나면 데이터를 자동으로 재검증. 자주 변경되지 않고 최신성이 중요하지 않는 데이터에 유용
- On-demand revalidation 이벤트를 기반으로 데이터를 수동 재검증. 최신 데이터를 가능한 빨리 보여주려는 경우에 유용

### 11.3.4 스트리밍을 활용한 점진적인페이지 불러오기

- ssr은 요청받은 페이지를 모두 렌더링헤서 내려줄 때까지 사용자에게 아무것도 보여줄 수 없으며, 하이드레이션 과정을 거쳐야만 비로소 온전하게 볼 수있어서 여전히 느림
- 스트리밍을 활용하면 페이지의 html을 더 작은 청크로 나누고 완성대는대로 점진적으로 서버에서 클라이언트로 보낼 수 있어서 빠르게 보여줄 수 있다

## 11.5 서버액션(alpha)

API 를 굳이 생성하지 않더라도 함수 수준에서 서버에 직접 접근해 데이터 요청 등을 수행할 수 있는 기능이다.

https://velog.io/@plastic041/Next.js-13.4%EC%9D%98-Server-Actions
